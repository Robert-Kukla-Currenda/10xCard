@using TenXCards.Frontend.Services
@using TenXCards.API.Models
@using Microsoft.AspNetCore.Components.Authorization
@using MudBlazor
@using MudBlazor.Utilities
@inject IAuthenticationService AuthService
@inject NavigationManager NavigationManager

<AuthorizeView Context="authContext">
    <Authorized>
        <MudMenu Icon="@Icons.Material.Filled.AccountCircle" Color="Color.Inherit" Direction="Direction.Bottom" OffsetY="true">
            <MudText Class="px-4 py-2">@authContext.User.Identity?.Name</MudText>
            <MudDivider />
            <MudMenuItem OnClick="HandleLogout">Wyloguj się</MudMenuItem>
        </MudMenu>
    </Authorized>
    <NotAuthorized>
        <MudStack Row="true" Spacing="2">
            <MudButton Variant="Variant.Text" Color="Color.Inherit" Href="/login">
                Zaloguj się
            </MudButton>
            <MudButton Variant="Variant.Outlined" Color="Color.Primary" Href="/register">
                Zarejestruj się
            </MudButton>
        </MudStack>
    </NotAuthorized>
</AuthorizeView>

@code {
    private async Task HandleLogout()
    {
        await AuthService.LogoutAsync();
        NavigationManager.NavigateTo("/");
    }
}